<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GoogleWhere - Guess the Location</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; text-align: center; background: #f0f0f0; }
  header { background: #2a7ae2; color: white; padding: 1rem 0; font-size: 1.5rem; }
  #game-container { max-width: 900px; margin: 1rem auto; background: white; padding: 1rem; border-radius: 8px; }
  #photo { max-width: 100%; border-radius: 8px; }
  #map { height: 400px; margin-top: 1rem; border-radius: 8px; }
  #guess-info { margin-top: 1rem; font-size: 1.2rem; }
  button { margin-top: 1rem; padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; border: none; border-radius: 4px; background: #2a7ae2; color: white; }
  button:disabled { background: gray; cursor: default; }
</style>
<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet" />
</head>
<body>
<header>GoogleWhere - Guess the Location</header>

<div id="game-container">
  <img id="photo" src="https://upload.wikimedia.org/wikipedia/commons/e/e6/Eiffel_Tower_from_the_trocadero%2C_Paris_5_March_2013.jpg" alt="Guess the location" />
  <div id="map"></div>
  <div id="guess-info">Click on the map to make your guess.</div>
  <button id="submit-btn" disabled>Submit Guess</button>
  <div id="result"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Real location for the sample image: Eiffel Tower, Paris
const realLocation = { lat: 48.8584, lng: 2.2945 };

let guessLocation = null;

const map = L.map('map').setView([20, 0], 2);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 18,
}).addTo(map);

const markerLayer = L.layerGroup().addTo(map);

map.on('click', function(e) {
  guessLocation = e.latlng;
  markerLayer.clearLayers();
  L.marker(guessLocation).addTo(markerLayer);
  document.getElementById('guess-info').textContent = `Your guess: Lat ${guessLocation.lat.toFixed(4)}, Lng ${guessLocation.lng.toFixed(4)}`;
  document.getElementById('submit-btn').disabled = false;
});

function toRadians(deg) {
  return deg * Math.PI / 180;
}

// Haversine formula to calculate distance between two coords (km)
function getDistance(lat1, lng1, lat2, lng2) {
  const R = 6371; // Earth radius in km
  const dLat = toRadians(lat2 - lat1);
  const dLng = toRadians(lng2 - lng1);
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
            Math.sin(dLng/2) * Math.sin(dLng/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

document.getElementById('submit-btn').addEventListener('click', () => {
  if (!guessLocation) return;

  const dist = getDistance(guessLocation.lat, guessLocation.lng, realLocation.lat, realLocation.lng);
  const resultDiv = document.getElementById('result');

  // Show real location marker
  L.marker(realLocation, {icon: L.icon({
    iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/RedDot.svg/120px-RedDot.svg.png',
    iconSize: [24, 24],
    iconAnchor: [12, 12],
  })}).addTo(markerLayer);

  resultDiv.innerHTML = `<p>You were <strong>${dist.toFixed(2)} km</strong> away from the correct location!</p>`;

  // Disable further clicks and submission
  map.off('click');
  document.getElementById('submit-btn').disabled = true;
  document.getElementById('guess-info').textContent = 'Game over! Refresh to play again.';
});
</script>

</body>
</html>
