<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GoogleWhere - Guess the Random Populated Place</title>
  <link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      background: #f0f0f0;
    }
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #2a7ae2;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      z-index: 10;
    }
    #leaderboard {
      width: 250px;
      background: white;
      padding: 1rem;
      overflow-y: auto;
      border-right: 1px solid #ddd;
      margin-top: 72px;
    }
    #leaderboard h3 {
      margin-top: 0;
      text-align: center;
    }
    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      margin-top: 72px;
      overflow-y: auto;
    }
    #play-area {
      display: flex;
      width: 100%;
      max-width: 1400px;
      gap: 1rem;
      flex-grow: 1;
    }
    #photo-container {
      flex: 1;
      min-width: 300px;
      max-width: 500px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
      height: 500px;
    }
    #photo-map {
      height: 100%;
      width: 100%;
    }
    #map {
      flex: 2;
      min-height: 500px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
    }
    #guess-info, #result {
      margin-top: 1rem;
      font-size: 1rem;
      max-width: 1400px;
    }
    button, input[type="text"] {
      margin-top: 1rem;
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    ul#scoreList {
      padding-left: 1rem;
    }
    @media (max-width: 900px) {
      #play-area {
        flex-direction: column;
      }
      #photo-container, #map {
        height: 300px;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>GoogleWhere - Guess the Random Populated Place</header>

  <div id="leaderboard">
    <h3>Leaderboard</h3>
    <ul id="scoreList"></ul>
  </div>

  <div id="main">
    <input type="text" id="playerName" placeholder="Enter your name" />
    <div id="play-area">
      <div id="photo-container">
        <div id="photo-map"></div>
      </div>
      <div id="map"></div>
    </div>
    <div id="guess-info">Click on the map to make your guess.</div>
    <button id="submit-btn" disabled>Submit Guess</button>
    <button id="next-btn" style="display:none;">Next Round</button>
    <div id="result"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const landRegions = [
      {name: "North America", bounds: [[24.396308,-125.0],[49.384358,-66.93457]]},
      {name: "Europe", bounds: [[36.0,-10.0],[60.0,30.0]]},
      {name: "South America", bounds: [[-55.0,-75.0],[-8.0,-34.0]]},
      {name: "Asia", bounds: [[5.0,60.0],[55.0,150.0]]},
      {name: "Africa", bounds: [[-35.0,-18.0],[37.0,51.0]]}
    ];

    function randomLatLngInBounds(bounds) {
      const southWest = bounds[0];
      const northEast = bounds[1];
      const lat = southWest[0] + Math.random() * (northEast[0] - southWest[0]);
      const lng = southWest[1] + Math.random() * (northEast[1] - southWest[1]);
      return { lat, lng };
    }

    function chooseRandomRegion() {
      return landRegions[Math.floor(Math.random() * landRegions.length)];
    }

    let selected = null;
    let guessLocation = null;
    let map = null;
    let photoMap = null;
    let markerLayer = null;
    let photoMarker = null;
    let submitBtn, nextBtn;

    function toRadians(deg) {
      return deg * Math.PI / 180;
    }

    function getDistance(lat1, lng1, lat2, lng2) {
      const R = 6371;
      const dLat = toRadians(lat2 - lat1);
      const dLng = toRadians(lng2 - lng1);
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
                Math.sin(dLng / 2) * Math.sin(dLng / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function updateLeaderboard(name, score) {
      let scores = JSON.parse(localStorage.getItem('leaderboard') || '[]');
      scores.push({ name, score });
      scores.sort((a, b) => a.score - b.score);
      localStorage.setItem('leaderboard', JSON.stringify(scores));
      renderLeaderboard(scores);
    }

    function renderLeaderboard(scores) {
      const list = document.getElementById('scoreList');
      list.innerHTML = '';
      scores.slice(0, 10).forEach(entry => {
        const li = document.createElement('li');
        li.textContent = `${entry.name} – ${entry.score.toFixed(1)} km`;
        list.appendChild(li);
      });
    }

    function startGame() {
      const region = chooseRandomRegion();
      selected = randomLatLngInBounds(region.bounds);
      guessLocation = null;
      document.getElementById('result').innerHTML = '';
      document.getElementById('guess-info').textContent = 'Click on the map to make your guess.';
      submitBtn.disabled = true;
      nextBtn.style.display = 'none';

      // Set photoMap to selected location zoom 15 (close up)
      photoMap.setView([selected.lat, selected.lng], 15);
      if (photoMarker) {
        photoMap.removeLayer(photoMarker);
      }
      photoMarker = L.marker([selected.lat, selected.lng]).addTo(photoMap);

      // Reset guess map
      map.setView([20, 0], 2);
      markerLayer.clearLayers();
      map.on('click', handleMapClick);
    }

    function handleMapClick(e) {
      const name = document.getElementById('playerName').value.trim();
      if (!name) {
        alert("Please enter your name before guessing.");
        return;
      }
      guessLocation = e.latlng;
      markerLayer.clearLayers();
      L.marker(guessLocation).addTo(markerLayer);
      document.getElementById('guess-info').textContent =
        `Your guess: Lat ${guessLocation.lat.toFixed(4)}, Lng ${guessLocation.lng.toFixed(4)}`;
      submitBtn.disabled = false;
    }

    window.onload = () => {
      submitBtn = document.getElementById('submit-btn');
      nextBtn = document.getElementById('next-btn');
      const scores = JSON.parse(localStorage.getItem('leaderboard') || '[]');
      renderLeaderboard(scores);

      // Initialize photo map (small close-up) with satellite + roads overlay
      photoMap = L.map('photo-map', { zoomControl: false, dragging: false, scrollWheelZoom: false, doubleClickZoom: false });
      // Satellite base
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles © Esri',
        maxZoom: 18
      }).addTo(photoMap);
      // Roads overlay (transparent)
      L.tileLayer('https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Roads © Esri',
        maxZoom: 18,
        opacity: 0.6,
        pane: 'overlayPane'
      }).addTo(photoMap);

      // Initialize guess map (big, interactive) - satellite only
      map = L.map('map');
      markerLayer = L.layerGroup().addTo(map);
      L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles © Esri',
        maxZoom: 18
      }).addTo(map);

      startGame();

      submitBtn.addEventListener('click', () => {
        const name = document.getElementById('playerName').value.trim();
        if (!name || !guessLocation) return;
        const dist = getDistance(guessLocation.lat, guessLocation.lng, selected.lat, selected.lng);
        document.getElementById('result').innerHTML =
          `<p>You were <strong>${dist.toFixed(2)} km</strong> away!</p>`;
        L.marker([selected.lat, selected.lng], {
          icon: L.icon({
            iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/RedDot.svg/120px-RedDot.svg.png',
            iconSize: [24, 24],
            iconAnchor: [12, 12],
          })
        }).addTo(markerLayer);
        updateLeaderboard(name, dist);
        submitBtn.disabled = true;
        map.off('click');
        document.getElementById('guess-info').textContent = 'Game over! Click "Next Round" to play again.';
        nextBtn.style.display = 'inline-block';
      });

      nextBtn.addEventListener('click', () => {
        startGame();
      });
    };
  </script>
</body>
</html>
